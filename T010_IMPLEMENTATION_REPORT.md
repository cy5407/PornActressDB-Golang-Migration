# T010 CRUD æ“ä½œå¯¦æ–½å ±å‘Š

**æ—¥æœŸ**: 2025-10-16  
**ä»»å‹™**: T010 - JSONDBManager åŸºç¤ CRUD æ–¹æ³•å¯¦ä½œ  
**ç‹€æ…‹**: âœ… **å®Œæˆ**  
**Git Commits**: 2d6cacb, 665fb2a

---

## å¯¦æ–½å…§å®¹

### æ–°å¢æ–¹æ³• (8 å€‹)

#### Video CRUD (4 å€‹)
1. **`add_or_update_video(video_info: VideoDict) -> str`**
   - æ–°å¢æˆ–æ›´æ–°å½±ç‰‡è¨˜éŒ„
   - è‡ªå‹•æ›´æ–° `updated_at` æ™‚é–“æˆ³
   - é©—è­‰åƒç…§å®Œæ•´æ€§
   - ç²å–å¯«é–å®šï¼ŒåŸå­æ“ä½œ

2. **`get_video_info(video_id: str) -> Optional[VideoDict]`**
   - æŸ¥è©¢å–®å€‹å½±ç‰‡
   - è¿”å›å®Œæ•´å½±ç‰‡è³‡è¨Š
   - ç²å–è®€é–å®š

3. **`get_all_videos(filter_dict: Optional[Dict]) -> List[VideoDict]`**
   - å–å¾—æ‰€æœ‰å½±ç‰‡æ¸…å–®
   - æ”¯æ´éæ¿¾ï¼ˆstudio, release_date_after/beforeï¼‰
   - ç²å–è®€é–å®š

4. **`delete_video(video_id: str) -> bool`**
   - åˆªé™¤å½±ç‰‡åŠç›¸é—œé—œè¯
   - æ¸…ç† video_actress_links
   - é©—è­‰å®Œæ•´æ€§ï¼ŒåŸå­æ“ä½œ

#### Actress CRUD (3 å€‹)
5. **`add_or_update_actress(actress_info: ActressDict) -> str`**
   - æ–°å¢æˆ–æ›´æ–°å¥³å„ªè¨˜éŒ„
   - è‡ªå‹•æ›´æ–° `updated_at` æ™‚é–“æˆ³
   - ç²å–å¯«é–å®š

6. **`get_actress_info(actress_id: str) -> Optional[ActressDict]`**
   - æŸ¥è©¢å–®å€‹å¥³å„ª
   - è¿”å›å®Œæ•´å¥³å„ªè³‡è¨Š

7. **`delete_actress(actress_id: str) -> bool`**
   - åˆªé™¤å¥³å„ªåŠç›¸é—œé—œè¯
   - æ¸…ç† video_actress_links

#### è¼”åŠ©æ–¹æ³• (1 å€‹)
8. **`_apply_video_filters(videos: List, filter_dict: Dict) -> List`**
   - éœæ…‹æ–¹æ³•ï¼Œæ‡‰ç”¨éæ¿¾æ¢ä»¶
   - æ”¯æ´ studio, release_date_after/before
   - è¿”å›éæ¿¾å¾Œçš„æ¸…å–®

---

## æŠ€è¡“ç‰¹æ€§

### ä¸¦è¡Œæ§åˆ¶
```
- è®€æ“ä½œ: ä½¿ç”¨ _acquire_read_lock()
  â””â”€ å…è¨±å¤šå€‹ä½µç™¼è®€å–
  
- å¯«æ“ä½œ: ä½¿ç”¨ _acquire_write_lock()
  â””â”€ ç¨ä½”é–å®šï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
  
- è‡ªå‹•é‡‹æ”¾: _release_locks()
  â””â”€ try-finally ç¢ºä¿é–å®šå¿…é‡‹æ”¾
```

### è³‡æ–™é©—è­‰
- åƒè€ƒå®Œæ•´æ€§æª¢æŸ¥ (FK ç´„æŸ)
- å‹åˆ¥é©—è­‰
- å¿…éœ€æ¬„ä½æª¢æŸ¥

### éŒ¯èª¤è™•ç†
- ValidationError: ç„¡æ•ˆè³‡æ–™
- LockError: é–å®šå¤±æ•—
- CorruptedDataError: å¯«å…¥å¤±æ•—
- è©³ç´°çš„æ—¥èªŒè¨˜éŒ„ (logger)

### æ™‚é–“æˆ³ç®¡ç†
```python
updated_at = datetime.now(timezone.utc).strftime(ISO_DATETIME_FORMAT)
# æ ¼å¼: ISO 8601 (ä¾‹: 2025-10-16T15:30:45.123456+00:00)
```

---

## é…ç½®èª¿æ•´

ç‚ºæ”¯æ´ Windows æª”æ¡ˆé–å®šè¡Œç‚ºï¼Œèª¿æ•´è¶…æ™‚ï¼š

```python
# src/models/json_types.py
READ_LOCK_TIMEOUT = 30       # ç§’ (åŸ: 5)
WRITE_LOCK_TIMEOUT = 60      # ç§’ (åŸ: 10)
```

**åŸå› **: Windows ä¸Š filelock æœ‰å»¶é²ï¼Œéœ€è¦æ›´é•·çš„è¶…æ™‚æ™‚é–“

---

## ç¨‹å¼ç¢¼çµ±è¨ˆ

| æŒ‡æ¨™ | æ•¸å€¼ |
|------|------|
| æ–°å¢ç¨‹å¼ç¢¼è¡Œæ•¸ | ~394 è¡Œ |
| æ–°å¢æ–¹æ³•æ•¸ | 8 å€‹ |
| ç•°å¸¸é¡å‹è¦†è“‹ | 5 ç¨® |
| æ—¥èªŒé» | 24+ è™• |
| æ–‡æª”å­—æ•¸ | ~1200 å­— |

---

## æ¸¬è©¦è¦†è“‹

### é©—è­‰é …ç›®
- âœ… å½±ç‰‡æ–°å¢æ“ä½œ
- âœ… å½±ç‰‡æŸ¥è©¢æ“ä½œ
- âœ… å½±ç‰‡æ¸…å–®æª¢ç´¢
- âœ… å½±ç‰‡ç¯©é¸æ“ä½œ
- âœ… å½±ç‰‡åˆªé™¤æ“ä½œ
- âœ… å¥³å„ªæ–°å¢æ“ä½œ
- âœ… å¥³å„ªæŸ¥è©¢æ“ä½œ
- âœ… å¥³å„ªåˆªé™¤æ“ä½œ
- âœ… ä¸¦è¡Œé–å®šæ©Ÿåˆ¶
- âœ… æ™‚é–“æˆ³è‡ªå‹•æ›´æ–°
- âœ… åƒç…§å®Œæ•´æ€§é©—è­‰

### åŠŸèƒ½é©—è­‰æµç¨‹
```
1. æ–°å¢å½±ç‰‡ â†’ é©—è­‰æ’å…¥
2. æŸ¥è©¢å½±ç‰‡ â†’ é©—è­‰æ¬„ä½
3. å–å¾—æ¸…å–® â†’ é©—è­‰è¨ˆæ•¸
4. ç¯©é¸æ¸…å–® â†’ é©—è­‰éæ¿¾
5. åˆªé™¤å½±ç‰‡ â†’ é©—è­‰ç§»é™¤
```

---

## åç»­æ•´åˆ

T010 CRUD æ–¹æ³•æ˜¯ä»¥ä¸‹ä»»å‹™çš„åŸºç¤:

| ä»»å‹™ | ä¾è³´ | ç”¨é€” |
|------|------|------|
| T008 | âœ… | é·ç§»å·¥å…·ä¸»å‡½å¼ (ä½¿ç”¨ CRUD å¯«å…¥) |
| T009 | âœ… | è³‡æ–™è½‰æ›é‚è¼¯ (æº–å‚™è³‡æ–™) |
| T011 | âœ… | è³‡æ–™å¯«å…¥é©—è­‰ (CRUD é©—è­‰) |
| T012 | âœ… | é·ç§»é©—è­‰å·¥å…· (æŸ¥è©¢é©—è­‰) |
| T016+ | âœ… | æ¥­å‹™é‚è¼¯é©é… (å®Œå…¨ä½¿ç”¨ JSON) |

---

## é€²åº¦æ›´æ–°

### æ•´é«”é€²åº¦
```
å·²å®Œæˆ: 8/32 ä»»å‹™ (25%)
  Phase 1: 3/3 âœ…
  Phase 2: 5/4 âœ… (å« T010)
  Phase 3+: 0/25 â³

ç¨‹å¼ç¢¼è¡Œæ•¸: ~1,136 è¡Œ (Phase 1-2)
Git æäº¤: 15 å€‹
```

### ä¸‹ä¸€æ­¥
**Phase 3 é–‹å§‹**: é·ç§»å·¥å…·å¯¦æ–½ (T008-T015)
- T008: é·ç§»ä¸»å‡½å¼
- T009: è³‡æ–™è½‰æ›
- T011-T015: é©—è­‰ã€æ—¥èªŒã€CLIã€æª¢æŸ¥æ¸…å–®

**é è¨ˆæ™‚é–“**: 1-2 å¤©

---

## Git æ­·å²

```
665fb2a (HEAD -> 001-sqlite-to-json-conversion)
        docs(tasks): mark T010 as completed

2d6cacb feat(T010): implement CRUD operations for JSONDBManager

a9ac5ec feat(T006-T007): implement backup/restore and parallel locking
```

---

**ç‹€æ…‹**: æº–å‚™é€²å…¥ Phase 3 é·ç§»å·¥å…·é–‹ç™¼ ğŸš€
