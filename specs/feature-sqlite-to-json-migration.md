# Feature Specification: SQLite è½‰æ›ç‚º JSON è³‡æ–™åº«å„²å­˜

**Feature Branch**: `feature/sqlite-to-json-migration`  
**Created**: 2025-10-16  
**Status**: Assessment & Planning  
**Input**: User description: "è©•ä¼°å¾ SQLite è½‰æ›ç‚º JSON å„²å­˜çš„å·¥ä½œé‡å’Œé¢¨éšª"

---

## ğŸ¯ Executive Summary

æœ¬è¦æ ¼æ–‡ä»¶è©³ç´°è©•ä¼°**å°‡ç¾æœ‰ SQLite è³‡æ–™åº«ç³»çµ±è½‰æ›ç‚º JSON æª”æ¡ˆå„²å­˜**çš„å·¥ä½œé‡ã€è¤‡é›œåº¦å’Œå¯¦æ–½ç­–ç•¥ã€‚

### æ ¸å¿ƒç™¼ç¾
- **å½±éŸ¿ç¯„åœ**: 15+ å€‹ Python æª”æ¡ˆéœ€è¦ä¿®æ”¹
- **é è¨ˆå·¥æ™‚**: **40-60 å°æ™‚** (å«æ¸¬è©¦å’Œé©—è­‰)
- **è¤‡é›œåº¦**: **é«˜** (å› æ¶æ§‹ç´šåˆ¥çš„æ”¹å‹•)
- **é—œéµé¢¨éšª**: è³‡æ–™å®Œæ•´æ€§ã€ä¸¦è¡Œå­˜å–ã€æ€§èƒ½
- **è½‰æ›æ–¹å¼**: å»ºè­°**é›™å±¤ä¸¦è¡Œ** (SQLite + JSON) è€Œéç›´æ¥æ›¿æ›

---

## ğŸ“Š è©³ç´°å·¥ä½œé‡åˆ†æ

### 1. **è³‡æ–™å±¤æ”¹é€ ** (15-20 å°æ™‚) âš ï¸ é—œéµè·¯å¾‘

#### 1.1 å»ºç«‹ JSON è³‡æ–™åº«ç®¡ç†å™¨ (8-10 å°æ™‚)
**æª”æ¡ˆ**: `src/models/database.py` â†’ æ–°å¢ `JSONDBManager` é¡åˆ¥

**ä»»å‹™æ¸…å–®**:
```python
# éœ€è¦å¯¦ç¾çš„æ ¸å¿ƒæ–¹æ³•
class JSONDBManager:
    def __init__(self, data_dir: str)           # åˆå§‹åŒ–ï¼Œå»ºç«‹ç›®éŒ„çµæ§‹
    def _load_all_data()                        # å¾ JSON æª”æ¡ˆè¼‰å…¥å…¨éƒ¨è³‡æ–™
    def _save_all_data()                        # åŸå­æ€§å¯«å…¥å…¨éƒ¨è³‡æ–™
    def _ensure_data_file_exists()              # æª”æ¡ˆå­˜åœ¨æ€§æª¢æŸ¥
    def add_or_update_video()                   # æ–°å¢/æ›´æ–°å½±ç‰‡ï¼ˆéœ€ä½µç™¼é–ï¼‰
    def get_video_info()                        # æŸ¥è©¢å½±ç‰‡
    def get_all_videos()                        # å–å¾—å…¨éƒ¨å½±ç‰‡
    def get_actress_statistics()                # å¥³å„ªçµ±è¨ˆï¼ˆJOIN é‚è¼¯é‡å¯«ï¼‰
    def get_studio_statistics()                 # ç‰‡å•†çµ±è¨ˆï¼ˆJOIN é‚è¼¯é‡å¯«ï¼‰
    def get_enhanced_actress_studio_statistics()# å¢å¼·ç‰ˆçµ±è¨ˆ
    def delete_video()                          # åˆªé™¤å½±ç‰‡ï¼ˆæ–°å¢ï¼‰
    def create_backup()                         # å‚™ä»½æ©Ÿåˆ¶ï¼ˆæ–°å¢ï¼‰
```

**è¤‡é›œæ€§åˆ†æ**:
- âœ… **æ–°å¢è¤‡é›œåº¦**: é ˆå¯¦ç¾ JOIN æŸ¥è©¢é‚è¼¯ (SQLite åŸç”Ÿæ”¯æŒï¼ŒJSON éœ€æ‰‹å‹•)
- âœ… **ä¸¦ç™¼è™•ç†**: é ˆåŠ å…¥è®€å¯«é– (threading.Lock / filelock)
- âœ… **æ€§èƒ½**: å…¨é‡è¼‰å…¥â†’ä¿®æ”¹â†’å…¨é‡å¯«å…¥ (éœ€å„ªåŒ–ç­–ç•¥)
- âš ï¸ **è³‡æ–™ä¸€è‡´æ€§**: éœ€å¹•ç­‰æ€§è¨­è¨ˆ (æ“ä½œå¤±æ•—æ™‚çš„æ¢å¾©)

#### 1.2 è³‡æ–™é·ç§»å·¥å…· (5-7 å°æ™‚)
**æª”æ¡ˆ**: æ–°å¢ `scripts/migrate_sqlite_to_json.py`

**ä»»å‹™**:
```python
# éœ€è¦å¯¦ç¾çš„é·ç§»é‚è¼¯
def export_sqlite_to_json():
    # 1. é€£æ¥ SQLiteï¼Œè®€å–å…¨éƒ¨è³‡æ–™
    # 2. æ§‹å»ºæ­£è¦åŒ–çš„ JSON çµæ§‹
    # 3. å¯«å…¥ JSON æª”æ¡ˆ (å«å‚™ä»½)
    # 4. é©—è­‰è³‡æ–™å®Œæ•´æ€§ (è¨ˆæ•¸ã€é›œæ¹Šæª¢æŸ¥)
    # 5. è¨˜éŒ„é·ç§»æ—¥èªŒ

def import_json_to_sqlite():
    # åå‘é·ç§»ï¼ˆå®‰å…¨å›é€€ï¼‰
    pass

def validate_migration():
    # é©—è­‰é·ç§»æˆåŠŸ
    pass
```

**è¤‡é›œæ€§**:
- éœ€è™•ç† NULL å€¼ã€é—œè¯è¡¨ (video_actress_link)
- éœ€é©—è­‰è³‡æ–™å‹åˆ¥è½‰æ› (TIMESTAMP â†’ ISO å­—ä¸²)
- éœ€ç”Ÿæˆé·ç§»å ±å‘Š

### 2. **æ¥­å‹™é‚è¼¯å±¤æ”¹é€ ** (8-12 å°æ™‚)

#### 2.1 Classifier Core é©é… (5-7 å°æ™‚)
**æª”æ¡ˆ**: `src/services/classifier_core.py`

**è®Šæ›´é»**:
```python
# èˆŠæ–¹å¼
self.db_manager = SQLiteDBManager(config.get('database', 'database_path'))

# æ–°æ–¹å¼
if config.get('database', 'type') == 'json':
    self.db_manager = JSONDBManager(config.get('database', 'data_dir'))
else:
    self.db_manager = SQLiteDBManager(config.get('database', 'database_path'))
```

**éœ€è¦ä¿®æ”¹çš„æ–¹æ³•**:
- `process_and_search_javdb()` - L260-370 (10+ è¡Œé‚è¼¯)
- `process_and_search_with_sources()` - L196-240
- `interactive_move_files()` - L385-450
- `smart_classify_by_actress()` - L500+

**å½±éŸ¿**: ç„¡å¯¦è³ªæ”¹è®Šï¼Œåªæ˜¯è³‡æ–™åº« API å‘¼å«

#### 2.2 å…¶ä»–æœå‹™é©é… (3-5 å°æ™‚)
**æª”æ¡ˆ**: 
- `src/services/studio_classifier.py` - ä½¿ç”¨ `db_manager.get_all_videos()`
- `src/services/interactive_classifier.py` - çµ±è¨ˆæŸ¥è©¢
- `src/ui/main_gui.py` - GUI æ•´åˆ

**è®Šæ›´é¡å‹**: å¤§å¤šæ˜¯é¡åˆ¥åˆå§‹åŒ–åƒæ•¸ä¿®æ”¹

### 3. **å¿«å–ç®¡ç†æ”¹é€ ** (5-8 å°æ™‚)

#### 3.1 Cache Manager é·ç§» (3-5 å°æ™‚)
**æª”æ¡ˆ**: `src/scrapers/cache_manager.py`

**ç¾ç‹€**:
```python
# ç›®å‰ä½¿ç”¨ SQLite å¿«å–
self.db_file = "cache_index.db"
with sqlite3.connect(str(self.db_path)) as conn:
    cursor = conn.cursor()
    # SQL æ“ä½œ...
```

**æ”¹é€ æ–¹æ¡ˆ**: JSON å¿«å– (å·²éƒ¨åˆ†æ”¯æŒ)
- å°‡ç´¢å¼•å¿«å–æ”¹ç‚º JSON
- ä¿æŒæœå°‹å¿«å– JSON æ ¼å¼ (ä¸è®Š)

#### 3.2 å¿«å–åºåˆ—åŒ– (2-3 å°æ™‚)
**æª”æ¡ˆ**: `src/scrapers/cache_manager.py`

**ä»»å‹™**:
- å¯¦ç¾ JSON å¿«å–ç´¢å¼•çš„åºåˆ—åŒ–
- è™•ç†å¿«å–éæœŸé‚è¼¯

### 4. **UI å±¤æ”¹é€ ** (3-5 å°æ™‚)

#### 4.1 GUI æ›´æ–°
**æª”æ¡ˆ**: `src/ui/main_gui.py`, `src/ui/preferences_dialog.py`

**è®Šæ›´**:
- æ–°å¢è³‡æ–™åº«é¡å‹é¸æ“‡ (è¨­å®šå°è©±æ¡†)
- æ–°å¢è³‡æ–™é·ç§»ç•Œé¢ (é€²åº¦æ¢ã€æ—¥èªŒ)
- æ–°å¢æ•ˆèƒ½ç›£è¦– (JSON è¼‰å…¥æ™‚é–“ç­‰)

### 5. **æ¸¬è©¦**  (8-12 å°æ™‚)

#### 5.1 å–®å…ƒæ¸¬è©¦ (4-6 å°æ™‚)
**æª”æ¡ˆ**: `tests/test_json_database.py` (æ–°å¢)

**æ¸¬è©¦è¦†è“‹**:
```python
class TestJSONDBManager:
    def test_add_or_update_video()          # CRUD åŸºæœ¬æ“ä½œ
    def test_get_video_info()               # æŸ¥è©¢
    def test_get_all_videos()               # æ‰¹é‡æŸ¥è©¢
    def test_concurrent_updates()           # ä¸¦ç™¼æ¸¬è©¦
    def test_actress_statistics()           # JOIN é‚è¼¯
    def test_data_persistence()             # æŒä¹…åŒ–é©—è­‰
    def test_json_file_corruption_recovery()# å®¹éŒ¯
    def test_migration_data_integrity()     # é·ç§»é©—è­‰
```

#### 5.2 æ•´åˆæ¸¬è©¦ (2-3 å°æ™‚)
- å®Œæ•´æœå°‹æµç¨‹
- GUI äº’å‹•æ¸¬è©¦
- æ•ˆèƒ½åŸºæº–æ¸¬è©¦

#### 5.3 è¿´æ­¸æ¸¬è©¦ (2-3 å°æ™‚)
- ç¾æœ‰åŠŸèƒ½é©—è­‰
- é‚Šç•Œæ¡ˆä¾‹

### 6. **æ–‡ä»¶èˆ‡éƒ¨ç½²** (3-5 å°æ™‚)

- é·ç§»æŒ‡å—
- API æ–‡ä»¶æ›´æ–°
- æ•ˆèƒ½åŸºæº–å ±å‘Š
- éƒ¨ç½²è…³æœ¬

---

## ğŸ”„ å½±éŸ¿æª”æ¡ˆæ¸…å–®

### ç›´æ¥ä¿®æ”¹ (15 å€‹æª”æ¡ˆ)
| æª”æ¡ˆ | ä¿®æ”¹é¡å‹ | è¤‡é›œåº¦ | æ™‚é–“ |
|------|---------|--------|------|
| `src/models/database.py` | é‡æ§‹ + æ–°é¡åˆ¥ | ğŸ”´ é«˜ | 8-10h |
| `src/services/classifier_core.py` | é©é… | ğŸŸ  ä¸­ | 3-4h |
| `src/services/studio_classifier.py` | é©é… | ğŸŸ¢ ä½ | 1h |
| `src/services/interactive_classifier.py` | é©é… | ğŸŸ¢ ä½ | 1h |
| `src/ui/main_gui.py` | æ“´å±• + é©é… | ğŸŸ  ä¸­ | 2-3h |
| `src/ui/preferences_dialog.py` | æ“´å±• | ğŸŸ  ä¸­ | 1-2h |
| `src/scrapers/cache_manager.py` | é·ç§» | ğŸŸ  ä¸­ | 3h |
| `src/models/config.py` | æ“´å±• | ğŸŸ¢ ä½ | 0.5h |
| `run.py` | é©é… | ğŸŸ¢ ä½ | 0.5h |
| `tests/test_*.py` | æ–°å¢ + ä¿®æ”¹ | ğŸŸ  ä¸­ | 8-10h |
| `scripts/migrate_sqlite_to_json.py` | æ–°å¢ | ğŸŸ  ä¸­ | 5-7h |
| `setup_github.ps1` | ç„¡æ”¹ | - | - |
| `example_*.py` | æ›´æ–° | ğŸŸ¢ ä½ | 1h |
| `config.ini` | æ“´å±• | ğŸŸ¢ ä½ | 0.5h |
| `requirements.txt` | å¯èƒ½æ–°å¢ | ğŸŸ¢ ä½ | 0.5h |

### é–“æ¥ç›¸é—œ (5+ æª”æ¡ˆ)
- `src/services/web_searcher.py` - æª¢æŸ¥ç›¸å®¹æ€§
- `src/services/safe_*.py` - æª¢æŸ¥ç›¸å®¹æ€§
- `docs/*.md` - æ–‡ä»¶æ›´æ–°

---

## âš ï¸ é—œéµé¢¨éšªèˆ‡æŒ‘æˆ°

### 1. **ä¸¦ç™¼å­˜å–** (é«˜é¢¨éšª) ğŸ”´
**å•é¡Œ**: JSON æª”æ¡ˆæ˜¯å–®æª”æ¡ˆï¼Œä¸æ”¯æ´åŸç”Ÿä¸¦ç™¼
- SQLite æœ‰ VACUUM, PRAGMA ç­‰æ©Ÿåˆ¶
- JSON éœ€è¦æª”æ¡ˆé– (file lock)

**è§£æ±ºæ–¹æ¡ˆ**:
```python
import filelock

class JSONDBManager:
    def __init__(self):
        self.lock = filelock.FileLock(f"{self.data_file}.lock")
    
    def add_or_update_video(self, code, info):
        with self.lock:  # æ’ä»–æ€§é–
            data = self._load()
            # ä¿®æ”¹è³‡æ–™
            self._save(data)
```

**æˆæœ¬**: +3-5 å°æ™‚

### 2. **æ€§èƒ½ä¸‹é™** (ä¸­é¢¨éšª) ğŸŸ 
**å•é¡Œ**: JSON å…¨é‡è¼‰å…¥ vs SQLite éƒ¨åˆ†æŸ¥è©¢
- è¼‰å…¥ 10,000 å€‹å½±ç‰‡: ~500ms (vs SQLite <10ms)
- å–®æ¬¡ä¿®æ”¹éœ€é‡æ–°å¯«å…¥æ•´å€‹æª”æ¡ˆ

**è§£æ±ºæ–¹æ¡ˆ**:
1. **è¨˜æ†¶é«”å¿«å–** - åœ¨è¨˜æ†¶é«”ä¿æŒå‰¯æœ¬ï¼Œå®šæ™‚åŒæ­¥
2. **åˆ†ç‰‡å„²å­˜** - æŒ‰é¦–å­—æ¯åˆ†æˆ 26 å€‹ JSON æª”æ¡ˆ
3. **ç•°æ­¥å¯«å…¥** - å¾Œå°åŸ·è¡Œç·’å®šæœŸ flush

**æˆæœ¬**: +10-15 å°æ™‚ (æ•ˆèƒ½å„ªåŒ–)

### 3. **è³‡æ–™å®Œæ•´æ€§** (é«˜é¢¨éšª) ğŸ”´
**å•é¡Œ**: å¯«å…¥éç¨‹ä¸­æ–·å¯èƒ½å°è‡´æª”æ¡ˆæå£
- SQLite æœ‰äº‹å‹™ (ACID)
- JSON ç„¡åŸç”Ÿäº‹å‹™

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# åŸå­æ€§å¯«å…¥ç­–ç•¥
def _save(self, data):
    temp_file = f"{self.data_file}.tmp"
    with open(temp_file, 'w') as f:
        json.dump(data, f)
    os.replace(temp_file, self.data_file)  # åŸå­æ“ä½œ
```

**æˆæœ¬**: +2-3 å°æ™‚

### 4. **çµ±è¨ˆæŸ¥è©¢è¤‡é›œåº¦** (ä¸­é¢¨éšª) ğŸŸ 
**å•é¡Œ**: JOIN æŸ¥è©¢éœ€è¦æ‰‹å‹•å¯¦ç¾
```python
# SQLite ç°¡å–®
SELECT a.name, COUNT(*) FROM actresses a 
JOIN video_actress_link va ON ...
GROUP BY a.name

# JSON è¤‡é›œ
actresses = {}
for video_id, actresses_list in video_actress_links.items():
    for actress_name in actresses_list:
        actresses[actress_name] = actresses.get(...) + 1
```

**æˆæœ¬**: +3-5 å°æ™‚

### 5. **æ¸¬è©¦è¦†è“‹** (ä¸­é¢¨éšª) ğŸŸ 
**å•é¡Œ**: éœ€è¦å¤§é‡ä¸¦ç™¼ã€é‚Šç•Œã€å®¹éŒ¯æ¸¬è©¦

**æˆæœ¬**: +8-10 å°æ™‚

---

## ğŸ“ˆ å·¥ä½œé‡ç¸½çµè¡¨

| éšæ®µ | å·¥é … | é è¨ˆå°æ™‚ | é—œéµé¢¨éšª |
|------|------|---------|---------|
| **1. è³‡æ–™å±¤** | JSON ç®¡ç†å™¨ | 8-10 | ä¸¦ç™¼ã€å®Œæ•´æ€§ |
| | é·ç§»å·¥å…· | 5-7 | è³‡æ–™é©—è­‰ |
| **2. æ¥­å‹™å±¤** | Core é©é… | 5-7 | é‚è¼¯ä¸€è‡´æ€§ |
| | å…¶ä»–é©é… | 3-5 | å…¼å®¹æ€§ |
| **3. å¿«å–å±¤** | å¿«å–é·ç§» | 5-8 | åºåˆ—åŒ– |
| **4. UI å±¤** | ä»‹é¢æ“´å±• | 3-5 | ä½¿ç”¨é«”é©— |
| **5. æ¸¬è©¦** | å–®å…ƒ + æ•´åˆ | 8-12 | è¦†è“‹åº¦ |
| **6. æ–‡ä»¶/éƒ¨ç½²** | æ–‡ä»¶ + è…³æœ¬ | 3-5 | æ¸…æ™°åº¦ |
| **ç¸½è¨ˆ** | | **40-60 å°æ™‚** | |

### æ™‚é–“ä¼°è¨ˆç¯„åœè§£è®€
- **å¿«é€Ÿè·¯å¾‘** (40 å°æ™‚): åŸºæœ¬è½‰æ›ï¼Œéƒ¨åˆ†åŠŸèƒ½æœªå„ªåŒ–
- **å®Œæ•´è·¯å¾‘** (60 å°æ™‚): å«æ€§èƒ½å„ªåŒ–ã€å…¨é¢æ¸¬è©¦

---

## ğŸ¯ æ¨è–¦æ–¹æ¡ˆï¼šæ¼¸é€²å¼è½‰æ›ç­–ç•¥

### éšæ®µ 1: ä¸¦è¡Œé›™å±¤ (ç¬¬ 1-2 é€±)
```
é…ç½®æ–‡ä»¶é¸æ“‡
â”œâ”€ "database.type": "sqlite"  (ç¾æœ‰)
â””â”€ "database.type": "json"    (æ–°å¢)

ä»£ç¢¼é©é…å±¤
â”œâ”€ SQLiteDBManager (ä¿ç•™)
â””â”€ JSONDBManager  (æ–°å¢)

åˆ‡æ›é‚è¼¯
```

**å„ªé»**:
- âœ… å¯éš¨æ™‚åˆ‡æ›å› SQLite
- âœ… ä¸¦è¡Œæ¸¬è©¦
- âœ… ç„¡é¢¨éšªé©—è­‰

**æˆæœ¬**: 40-50 å°æ™‚

### éšæ®µ 2: æ€§èƒ½å„ªåŒ– (ç¬¬ 3 é€±)
- è¨˜æ†¶é«”å¿«å–
- åˆ†ç‰‡å„²å­˜
- ç•°æ­¥å¯«å…¥

**æˆæœ¬**: +10-15 å°æ™‚

### éšæ®µ 3: å®Œå…¨é·ç§» (ç¬¬ 4 é€±)
- ç§»é™¤ SQLite ä»£ç¢¼
- æ¸…ç†ç›¸å®¹å±¤
- æœ€çµ‚æ¸¬è©¦

**æˆæœ¬**: +5-10 å°æ™‚

**ç¸½æ™‚ç¨‹**: **3-4 é€±** (é è¨ˆ 60-75 å°æ™‚)

---

## ğŸ“‹ User Scenarios & Testing (Priority-Ordered)

### User Story 1 - è½‰æ›ç¾æœ‰è³‡æ–™ (Priority: P1)
**ä½¿ç”¨è€…è§’è‰²**: ç³»çµ±ç®¡ç†å“¡
**å ´æ™¯**:
1. åŸ·è¡Œé·ç§»å·¥å…·
2. çœ‹åˆ°é€²åº¦æ¢ (å·²è™•ç† X/N è¨˜éŒ„)
3. é·ç§»å®Œæˆï¼Œç”Ÿæˆé©—è­‰å ±å‘Š
4. é©—è­‰è³‡æ–™ä¸€è‡´æ€§ (è¡Œæ•¸ã€å¥³å„ªæ•¸ç­‰)

**Why P1**: ç„¡æ³•è½‰æ›è³‡æ–™æ„å‘³è‘—æ•´å€‹åŠŸèƒ½ç„¡æ³•ä½¿ç”¨

**Independent Test**: åŸ·è¡Œé·ç§»è…³æœ¬ â†’ é©—è­‰è¼¸å‡ºæª”æ¡ˆå…§å®¹ â†’ å°æ¯” SQLite è³‡æ–™

### User Story 2 - ç³»çµ±è‡ªå‹•åˆ‡æ›è³‡æ–™åº« (Priority: P1)
**ä½¿ç”¨è€…è§’è‰²**: ä½¿ç”¨è€…
**å ´æ™¯**:
1. ç·¨è¼¯ config.iniï¼Œè¨­å®š `database.type=json`
2. å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
3. æ‡‰ç”¨ç¨‹å¼è‡ªå‹•ä½¿ç”¨ JSON è³‡æ–™åº«

**Why P1**: ç„¡æ³•åˆ‡æ›è¡¨ç¤ºæ¶æ§‹é©é…å¤±æ•—

**Independent Test**: æ”¹è®Šé…ç½® â†’ é‡å•Ÿ â†’ é©—è­‰è³‡æ–™å¯è®€å¯«

### User Story 3 - æœå°‹åŠŸèƒ½æ­£å¸¸é‹ä½œ (Priority: P1)
**ä½¿ç”¨è€…è§’è‰²**: çµ‚ç«¯ä½¿ç”¨è€…
**å ´æ™¯**:
1. é¸æ“‡å½±ç‰‡è³‡æ–™å¤¾
2. åŸ·è¡Œæœå°‹ (ä½¿ç”¨ JSON è³‡æ–™åº«)
3. çµæœå„²å­˜æˆåŠŸ
4. ä¸‹æ¬¡å•Ÿå‹•æ™‚å¯è®€å–

**Why P1**: æ ¸å¿ƒåŠŸèƒ½å¿…é ˆå·¥ä½œ

**Independent Test**: å®Œæ•´æœå°‹æµç¨‹ â†’ é©—è­‰ JSON æª”æ¡ˆ â†’ é‡å•Ÿé©—è­‰è³‡æ–™

### User Story 4 - æ•ˆèƒ½å¯æ¥å— (Priority: P2)
**ä½¿ç”¨è€…è§’è‰²**: ä½¿ç”¨è€…
**å ´æ™¯**:
1. è¼‰å…¥ 10,000+ å½±ç‰‡
2. ä»‹é¢éŸ¿æ‡‰æ™‚é–“ < 2s
3. æœå°‹çµæœ < 3s

**Why P2**: åŸºæœ¬åŠŸèƒ½æ­£å¸¸å¾Œæ‰é—œæ³¨æ€§èƒ½

**Independent Test**: è¨˜éŒ„å„æ“ä½œè€—æ™‚ â†’ å°æ¯”åŸºæº–

### User Story 5 - è³‡æ–™å‚™ä»½èˆ‡å¾©åŸ (Priority: P2)
**ä½¿ç”¨è€…è§’è‰²**: ç³»çµ±ç®¡ç†å“¡
**å ´æ™¯**:
1. ç³»çµ±è‡ªå‹•å»ºç«‹å‚™ä»½ (æ¯æ—¥)
2. é‡åˆ°æå£å¯å¾©åŸ
3. æä¾›å¾©åŸæ—¥èªŒ

**Why P2**: å®¹ç½ä½†éé¦–è¦

**Independent Test**: åˆªé™¤ JSON æª”æ¡ˆ â†’ å¾©åŸ â†’ é©—è­‰

### User Story 6 - ä¸¦ç™¼æ“ä½œç„¡è¡çª (Priority: P3)
**ä½¿ç”¨è€…è§’è‰²**: å¤šä½¿ç”¨è€…ç’°å¢ƒ
**å ´æ™¯**:
1. å…©å€‹é€²ç¨‹åŒæ™‚ä¿®æ”¹è³‡æ–™
2. ç„¡è³‡æ–™éºå¤±/æå£
3. æ“ä½œåºåˆ—åŒ–æ­£ç¢º

**Why P3**: ç•¶å‰å–®ç”¨æˆ¶ï¼Œå¤šç”¨æˆ¶ç‚ºæœªä¾†

**Independent Test**: å¤šåŸ·è¡Œç·’æ¸¬è©¦

---

## âœ… Success Criteria

### åŠŸèƒ½æ€§æˆåŠŸæ¨™æº–
1. **è³‡æ–™å®Œæ•´æ€§**: 
   - âœ… é·ç§»å¾Œè¨˜éŒ„æ•¸ = é·ç§»å‰è¨˜éŒ„æ•¸
   - âœ… æ‰€æœ‰é—œè¯é—œä¿‚ä¿ç•™
   - âœ… æ™‚é–“æˆ³è¨˜ç²¾åº¦ä¿ç•™ (ç§’ç´š)

2. **API ç›¸å®¹æ€§**:
   - âœ… JSONDBManager æä¾›èˆ‡ SQLiteDBManager ç›¸åŒçš„å…¬é–‹ä»‹é¢
   - âœ… ç¾æœ‰ä»£ç¢¼ç„¡éœ€ä¿®æ”¹å¯ä½¿ç”¨
   - âœ… å–®å…ƒæ¸¬è©¦é€šéç‡ â‰¥ 95%

3. **æœå°‹åŠŸèƒ½**:
   - âœ… æœå°‹æˆåŠŸç‡èˆ‡ SQLite ç›¸åŒ
   - âœ… è³‡æ–™å„²å­˜æ­£ç¢º
   - âœ… çµ±è¨ˆæŸ¥è©¢çµæœæº–ç¢º

### æ€§èƒ½æ¨™æº–
4. **è¼‰å…¥æ™‚é–“**:
   - âœ… åˆå§‹è¼‰å…¥ 10,000 æ¢è¨˜éŒ„ < 1s (è¨˜æ†¶é«”å¿«å–å¾Œ)
   - âœ… å–®æ¬¡æŸ¥è©¢ < 100ms
   - âœ… ä¸å› è³‡æ–™é‡å¢åŠ è€Œç·šæ€§ä¸‹é™

5. **å¯«å…¥æ“ä½œ**:
   - âœ… æ–°å¢å½±ç‰‡ < 500ms
   - âœ… æ‰¹é‡æ›´æ–° < 2s (for 100 records)
   - âœ… æª”æ¡ˆå¤§å° vs SQLite åœ¨ 10% å…§

### å¯é æ€§æ¨™æº–
6. **è³‡æ–™å®‰å…¨**:
   - âœ… å¯«å…¥å¤±æ•—è‡ªå‹•å›å¾©
   - âœ… ä¸¦ç™¼æ“ä½œç„¡è³‡æ–™éºå¤±
   - âœ… æå£æª”æ¡ˆå¯å¾©åŸ

7. **æ¸¬è©¦è¦†è“‹**:
   - âœ… æ ¸å¿ƒæ–¹æ³•è¦†è“‹ç‡ â‰¥ 85%
   - âœ… é‚Šç•Œæ¡ˆä¾‹è¦†è“‹ â‰¥ 80%
   - âœ… ç„¡å›æ­¸ç¼ºé™·

---

## ğŸ“ Assumptions & Constraints

### å‡è¨­
1. âœ… ä½¿ç”¨è€…æ¥å—çŸ­æœŸæ€§èƒ½ä¸å¦‚ SQLite (å¾ŒæœŸå„ªåŒ–)
2. âœ… è³‡æ–™é‡ä¸è¶…é 100,000 æ¢è¨˜éŒ„
3. âœ… å–®ä¸€ä½¿ç”¨è€…æˆ–ä½ä¸¦ç™¼ç’°å¢ƒ
4. âœ… ç£ç¢Ÿç©ºé–“å……è¶³ (JSON > SQLite 5-10%)

### é™åˆ¶
1. ğŸ”´ **ä¸¦ç™¼é™åˆ¶**: éœ€è¦æª”æ¡ˆé–å¯¦ç¾åºåˆ—åŒ–
2. ğŸ”´ **è¤‡é›œæŸ¥è©¢**: JOIN éœ€è¦æ‰‹å‹•å¯¦ç¾ (å¯èƒ½ç”¢ç”Ÿæ€§èƒ½å•é¡Œ)
3. ğŸŸ  **ç‰ˆæœ¬ç›¸å®¹æ€§**: éœ€è¦å‘å¾Œç›¸å®¹ SQLite è³‡æ–™

### ç›¸ä¾æ€§
- `filelock` å¥—ä»¶ (æ–°å¢ä¾è³´)
- Python 3.7+ (pathlib)
- ç¾æœ‰ JSON å¿«å–çµæ§‹

---

## ğŸš€ å»ºè­°çš„é€²åº¦

### ç¬¬ 1 é€±: æ ¸å¿ƒæ§‹å»º
- âœ… å¯¦ç¾ JSONDBManager åŸºç¤é¡åˆ¥
- âœ… å¯¦ç¾è³‡æ–™é·ç§»å·¥å…·
- âœ… åŸºæœ¬å–®å…ƒæ¸¬è©¦

**æ™‚é–“**: 15-20 å°æ™‚

### ç¬¬ 2 é€±: æ•´åˆèˆ‡æ¸¬è©¦
- âœ… æ¥­å‹™å±¤é©é… (Classifier Core ç­‰)
- âœ… æ•´åˆæ¸¬è©¦
- âœ… ä¸¦ç™¼æ¸¬è©¦

**æ™‚é–“**: 15-20 å°æ™‚

### ç¬¬ 3 é€±: å„ªåŒ–èˆ‡é©—è­‰
- âœ… æ€§èƒ½å„ªåŒ– (å¯é¸)
- âœ… GUI æ“´å±• (å¯é¸)
- âœ… å®Œæ•´è¿´æ­¸æ¸¬è©¦

**æ™‚é–“**: 10-15 å°æ™‚

### ç¬¬ 4 é€±: éƒ¨ç½²èˆ‡æ–‡ä»¶
- âœ… éƒ¨ç½²è…³æœ¬
- âœ… é·ç§»æŒ‡å—
- âœ… æœ€çµ‚é©—æ”¶

**æ™‚é–“**: 5-10 å°æ™‚

---

## ğŸ“‹ Key Entities (Data Model)

### JSON è³‡æ–™çµæ§‹è¨­è¨ˆ

```json
{
  "metadata": {
    "version": "1.0",
    "created": "2025-10-16T22:00:00Z",
    "last_updated": "2025-10-16T23:00:00Z",
    "record_count": 150
  },
  "videos": {
    "SONE-909": {
      "id": 1,
      "code": "SONE-909",
      "original_filename": "SONE-909.mp4",
      "file_path": "/videos/SONE-909.mp4",
      "studio": "S1",
      "studio_code": "SONE",
      "release_date": "2024-06-26",
      "search_method": "JAVDB",
      "last_updated": "2025-10-16T10:30:00Z",
      "search_status": "searched_found",
      "last_search_date": "2025-10-16T10:30:00Z",
      "actress_ids": [1, 2]  // é—œè¯å¥³å„ª ID
    }
  },
  "actresses": {
    "1": {
      "id": 1,
      "name": "ç™½ä¸Šå’²èŠ±"
    },
    "2": {
      "id": 2,
      "name": "å…¶ä»–å¥³å„ª"
    }
  },
  "studios": {
    "SONE": {
      "code": "SONE",
      "name": "S1 NO.1 STYLE"
    }
  },
  "video_actress_links": {
    "1": {
      // video_id: 1
      "actress_ids": [1, 2],
      "association_types": ["primary", "collaboration"]
    }
  }
}
```

### é—œéµå¯¦é«”é—œä¿‚
- **Videos** â†” **Actresses**: å¤šå°å¤š (via video_actress_links)
- **Videos** â†” **Studios**: å¤šå°ä¸€
- æ‰€æœ‰æ™‚é–“æˆ³çµ±ä¸€ç‚º ISO 8601 æ ¼å¼

---

## [NEEDS CLARIFICATION: 1] æ˜¯å¦éœ€è¦å®Œå…¨æ›¿æ› SQLiteï¼Œé‚„æ˜¯ä¸¦è¡Œæ”¯æŒ?

**Context**: ç›®å‰ç³»çµ±å®Œå…¨ä¾è³´ SQLiteã€‚è½‰æ›æ–¹å¼æœƒå½±éŸ¿å·¥ä½œé‡å’Œé¢¨éšªã€‚

**What we need to know**: è½‰æ›ç­–ç•¥çš„å„ªå…ˆç´š

| é¸é … | åšæ³• | å„ªé» | ç¼ºé» | å·¥æ™‚å·®ç•° |
|------|------|------|------|---------|
| A | **å®Œå…¨æ›¿æ›** - ç§»é™¤æ‰€æœ‰ SQLite ä»£ç¢¼ | ä»£ç¢¼ç°¡æ½” | ç„¡å›é€€æ–¹æ¡ˆï¼Œé¢¨éšªé«˜ | åŸºæº– |
| B | **ä¸¦è¡Œé›™å±¤** (æ¨è–¦) - SQLite + JSON ä¸¦å­˜ | å¯éš¨æ™‚åˆ‡æ›ï¼Œé¢¨éšªä½ | ä»£ç¢¼è¤‡é›œåº¦å¢åŠ  | +2-3h |
| C | **æ¼¸é€²é·ç§»** - å…ˆ SQLiteï¼Œå®šæœŸåŒæ­¥åˆ° JSON | æœ€å®‰å…¨ | æœ€è¤‡é›œ | +5-8h |

**Suggested Answer**: 
- æ¨è–¦ **B (ä¸¦è¡Œé›™å±¤)**: å¯é€šéé…ç½®æ–‡ä»¶åˆ‡æ›ï¼Œå¯¦é©—æ€§åŠŸèƒ½
- å¯¦ç¾é †åº: B â†’ C (å¦‚éœ€å®Œæ•´é·ç§»)

---

## [NEEDS CLARIFICATION: 2] æ•ˆèƒ½å¦‚ä½•é‡æ–°å®šç¾©? æ˜¯å¦å¯æ¥å—åˆæœŸçš„æ€§èƒ½ä¸‹é™?

**Context**: JSON å…¨é‡è¼‰å…¥å¿…ç„¶æ¯” SQLite æ…¢ã€‚éœ€è¦ç¢ºèªå¯æ¥å—çš„æ€§èƒ½æŒ‡æ¨™ã€‚

| æŒ‡æ¨™ | SQLite åŸºç·š | JSON åˆæœŸ | JSON å„ªåŒ–å¾Œ |
|------|-----------|---------|----------|
| è¼‰å…¥ 10k è¨˜éŒ„ | 5-10ms | 500ms | 50ms (å¿«å–å¾Œ) |
| æŸ¥è©¢å–®ç­† | < 5ms | 50-100ms | < 10ms (å¿«å–) |
| æ–°å¢è¨˜éŒ„ | 20-50ms | 500-1000ms | 100-200ms |

**Your choice**: _ä¾è³´æ–¼ç”¨æˆ¶å®¹å¿åº¦_

---

## [NEEDS CLARIFICATION: 3] è³‡æ–™é‡è¦æ¨¡é æœŸ? å½±éŸ¿åˆ†ç‰‡ç­–ç•¥

**Context**: 100 æ¢ vs 100,000 æ¢è¨˜éŒ„å½±éŸ¿ JSON åˆ†ç‰‡æ˜¯å¦å¿…è¦ã€‚

| è¦æ¨¡ | å–®æª”æ¡ˆç­–ç•¥ | å»ºè­°åˆ†ç‰‡ | JSON æª”æ¡ˆå¤§å° |
|------|----------|---------|------------|
| < 1,000 | âœ… å¯è¡Œ | ä¸éœ€è¦ | < 1 MB |
| 1-10k | âš ï¸ å¯è¡Œ | è€ƒæ…® | 1-10 MB |
| 10-100k | âŒ ä¸å»ºè­° | âœ… å¿…é ˆ | 10-100 MB |

**Your choice**: _ä¼°è¨ˆç•¶å‰è³‡æ–™é‡å’Œæˆé•·ç‡_

---

## çµè«–èˆ‡å»ºè­°

### âœ… æœ¬è¦æ ¼é©åˆä»¥ä¸‹æƒ…æ³
- æƒ³è¦**è©•ä¼°è½‰æ›å·¥ä½œé‡**
- æƒ³è¦**ç†è§£æŠ€è¡“é¢¨éšª**
- è¨ˆåŠƒ**é•·æœŸ Go é‡æ§‹** (JSON æ˜¯ç›®æ¨™)
- éœ€è¦**è©³ç´°çš„å·¥ä½œåˆ†è§£**

### ğŸ¯ å»ºè­°çš„ä¸‹ä¸€æ­¥
1. **ç¢ºèªæ±ºç­–**: é¸æ“‡ä¸¦è¡Œé›™å±¤é‚„æ˜¯å®Œå…¨æ›¿æ›
2. **å®šç¾©æ€§èƒ½ç›®æ¨™**: å¯æ¥å—çš„æ€§èƒ½æ°´æº–
3. **é–‹å§‹ç¬¬ 1 é€±**: å¯¦ç¾ JSONDBManager åŸºç¤é¡åˆ¥
4. **é€²è¡Œ POC**: å°è¦æ¨¡è³‡æ–™é·ç§»é©—è­‰

### ğŸ“Š å·¥ä½œè©•ä¼°ç¸½çµ
| é …ç›® | è©•ä¼° |
|------|------|
| **ç¸½å·¥æ™‚** | **40-60 å°æ™‚ (ä¾ç­–ç•¥)** |
| **ä¿®æ”¹æª”æ¡ˆ** | **15 å€‹ç›´æ¥ä¿®æ”¹ + 5 å€‹æŸ¥æ ¸** |
| **è¤‡é›œåº¦** | **é«˜ (æ¶æ§‹ç´šåˆ¥æ”¹å‹•)** |
| **é¢¨éšª** | **ä¸­-é«˜ (éœ€å……åˆ†æ¸¬è©¦)** |
| **æ¨è–¦é€²åº¦** | **3-4 é€± (å…¨è·)** |
| **å»ºè­°å„ªå…ˆç´š** | **P3 (Go é‡æ§‹å‰é€²è¡Œ)** |

---

**Specification Status**: âœ… Ready for Clarification â†’ Planning Phase

